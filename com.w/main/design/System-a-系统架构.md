# 架构历史演变

## 时间线

### 90s

> CS架构

服务与客户端的分离

### 2000

> 去中心化

浏览器成为客户端软件

### 2006

> 云托管

云平台提供基础功能，分布式计算，网络，存储等，这种情况下成本的把控更方便

### 2014

> 微服务

打造细粒度拆分服务

SSH，UI 业务逻辑并未分离

### 分布式系统

三层架构和实践

DDD 域驱动设计

企业集成模式 EIP

SOA

松耦合技术

## 系统架构

### 垂直架构-MVC

> 随着业务规模的增大

1. 维护成本，部署效率低下
2. 团队协作，公共模块重复开发
3. 系统可靠性太差，系统模块间强关联
4. 维护的定制困难
5. 新功能上线周期变长{1.测试周期，2.新特性无法独立部署和设计}

**可用**：双机热备

**关键**：前后台逻辑分离MVC

为解决一些公共模块的处理问题，抽离出来，设计为服务，独立部署，接口调用由本地API改为跨进程的远程调用，RPC应运而生

### RPC架构

- 简单：RPC概念语义简单，构建计算简单
- 高效：过程调用简单而高效
- 通用：通用的通信机制

> 2006之后RPC框架的普及标志着传统垂直应用架构时代的终结

核心技术点：

1. 远程服务需要提供服务调用相关信息{服务接口，数据结构，中间态的服务定义文件}
2. 远程代理对象：远程调用的服务实际上是远程服务的本地代理
3. 通信：RPC框架与具体协议无关
4. 序列化：远程通信，需要将对象转为二进制码流进行网络传输

**关键**：提高业务复用及拆分

> 当服务越来越多，服务间的依赖关系变的错综复杂，服务间的调用关系分析十分困难，一句话：服务治理困难

### SOA服务化架构

粗粒度，松耦合的以服务为中心的架构，接口间通过明确的协议和接口进行通信

原则：

1. 服务可复用：服务均被设计为潜在的可复用
2. 服务共享一个标准契约：消费者需要导入服务提供者的服务契约
3. 服务是松耦合的：服务被设计为功能相对独立，尽量不依赖其他服务的独立功能提供者
4. 服务是底层逻辑的抽象：契约暴露的服务对外可见，除此之外均不可见
5. 服务可组合，可编排：自由的组合编排
6. 服务自治：逻辑由服务控制，位于一个清晰的边界内
7. 服务是无状态的：服务应当不必维持状态，维持松耦合性
8. 可被自动发现：允许被其他消费者自动发现，服务提供者下线后，允许消费者接收服务下线通知

**关键**：用于提升服务质量的SOA服务治理

### 微服务架构

将应用进一步拆分，提高其复用性，同时使用提供相应的治理模块减小其业务的治理问题

**特点**

1. 原子服务：专一原则
2. 高密度部署：核心服务单独部署，非核心可设到一个进程中部署，物理机，服务可部署到同一个服务器
3. 敏捷交付：小团队负责设计、开发、测试、部署、线上治理、灰度发布和服务下线，实现真正的DevOps
4. 微自治：服务足够小，功能单一，可独立打包、部署、升级、回滚和贪心伸缩、不依赖其他服务，局部自治

**模块**

配置中心：当多节点的部署，当配置变动时人力去调整配置是很麻烦的

服务注册与发现中心：动态的服务监控及管理

负载均衡：尽可能提高请求的均摊

断路器：故障处理

网关：减少服务调用者的压力，由网关路由到对应的服务提供者

消息通信：基于网络的RPC调用框架，提供高性能的网络请求受理

缺点：运维，监控（分离部署，跨进程监控），跟踪难（例如API过期），分布式架构存在的问题，跨语言、团队带来的重复工作

优势：模块独立部署，团队更专注，服务间松耦合，与语言工具无关

## 比较

### SOA-微服务

- 拆分粒度
- 服务依赖：微服务的依赖更小，强调自治
- 服务规模：微服务拆分更小，部署规模更大，带来的治理挑战更大
- 架构差异：集成总线被P2P虚拟总线代替，确保了高性能、低延时
- 服务治理：传统静态治理转换为动态治理
- 敏捷交付

## 大规模系统拆分

### 纵向拆分

不同业务模块为基准拆分

### 横向拆分

核心的、公共的拆分出来

### 服务治理问题

- 生命周期管理
- 服务容量划分
- 运行期治理
- 服务安全

迭代：

1. SOA Governnace
2. 以分布式框架为中心的服务治理
3. 微服务架构和云端治理