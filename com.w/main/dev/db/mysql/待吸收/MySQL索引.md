# MySQL索引

## 基础知识储备

### 局部性原理

### 磁盘预读

读取存储页，过多页的读取会影响性能

## 索引

索引存储文件系统中

索引存储形式与存储引擎有关

索引文件结构

> - hash
> - 二叉树
> - B树
> - B+树

缺点

​	二叉树

​	红黑树

> 左旋等这种操作仍然会耗费资源

- 当树的深度过深时会造成IO次数变多影响读取性能

#### 应对

- 减少IO量
- 减少IO次数

#### B树：

##### 特点

> - 所有键值分布在整颗树中
> - 搜索有可能在非叶子节点结束，关键字全集内做一次二分查找性能逼近二分查找
> - 每个节点最多拥有m个子树
> - 根节点最少2颗
> - 分支节点（除根和叶子以外的节点）最少m/2个
> - 所有叶子节点都在同一层，每个节点最多m-1个key，升序排列

键值 | 数据

缺点

​	**data变大**，则其key会变少

​	这样树量大的时候，树深变深，IO性能降低

#### B+树：

##### 相当于与B树上的优化

每个节点包含更多节点（1,为了降低树的高度，2，将区间细化）

非叶子节点：key

叶子节点：key+data

叶子节点两两指针相连（符合磁盘预读的特性），顺序查询性能更高

## 索引分类

主键索引

唯一索引

- 索引列的值必须唯一，值可为空

普通索引

- 值可以为空

全文索引

- 索引类型为：FULLTEXT
- 可在varchar,char,text类型列上创建索引

组合索引

- 多列值创建一个索引
- 用于组合搜索

## 存储引擎

|          | MyISAM     | InnoDB                   |
| -------- | ---------- | ------------------------ |
| 索引类型 | 非聚簇索引 | 聚簇索引                 |
| 支持事务 |            | O                        |
| 支持表锁 | O          | O                        |
| 支持行锁 |            | O                        |
| 支持外键 |            | O                        |
| 全文索引 | O          | O                        |
|          | 大量select | 大量insert,delete,update |



## InnoDB--B+tree

依据主键创建索引，叶子节点中存储**数据**--->

​	没有主键--->选择唯一键

​		没有唯一键--->6位的row_id作为主键（用户不可见）

如果创建索引的键是其他字段，则叶子节点中存储的是该记录的主键，通过这个主键索引可以查出对应的记录

## MyISAM--B+tree

叶子节点存储的是对于的数据的**地址**

# 问题

## 慢查询优化

索引

## 加索引为何能优化慢查询

减少磁盘IO次数

## 哪些数据结构可提高查询速度

## MySQL为何选择B+树

