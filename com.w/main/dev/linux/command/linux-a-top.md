# Top

## 基础

**VIRT：virtual memory usage 虚拟内存
**1、进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据等
2、假如进程申请100m的内存，但实际只使用了10m，那么它会增长100m，而不是实际的使用量

**RES：resident memory usage 常驻内存**
1、进程当前使用的内存大小，但不包括swap out
2、包含其他进程的共享
3、如果申请100m的内存，实际使用10m，它只增长10m，与VIRT相反
4、关于库占用内存的情况，它只统计加载的库文件所占内存大小

**SHR：shared memory 共享内存**
1、除了自身进程的共享内存，也包括其他进程的共享内存
2、虽然进程只使用了几个共享库的函数，但它包含了整个共享库的大小
3、计算某个进程所占的物理内存大小公式：RES – SHR
4、swap out后，它将会降下来

**DATA**
1、数据占用的内存。如果top没有显示，按f键可以显示出来。
2、真正的该程序要求的数据空间，是真正在运行中要使用的。

## top使用

**使用格式：**

**top [-] [d] [p] [q] [c] [C] [S] [s] [n]**

**参数说明：**

| 命令 | 功能                                                         |
| ---- | ------------------------------------------------------------ |
| d    | 每两次屏幕信息刷新之间的时间间隔                             |
| p    | pid，指定要监控的进程                                        |
| q    | 该选项将使top没有任何延迟的进行刷新。如果调用程序有超级用户权限，那么top将以尽可能高的优先级运行。 |
| S    | 指定累计模式                                                 |
| s    | 使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险。 |
| i    | 使top不显示任何闲置或者僵死进程                              |
| c    | 显示整个命令行而不只是显示命令名                             |

**常用命令说明：**

Ctrl+L：擦除并且重写屏幕

r:重新安排一个进程的优先级别。系统提示用户输入需要改变的进程PID以及需要设置的进程优先级值。输入一个正值将使优先级降低，反之则可以使该进程拥有更高的优先权。默认值是10。

f或者F：从当前显示中添加或者删除项目。


o或者O：改变显示项目的顺序

W:将当前设置写入~/.toprc文件中。

## 内部命令

| 操作对象 | 命令 | 交互                                 | 功能                         |
| -------- | ---- | ------------------------------------ | ---------------------------- |
| 刷新频率 | s    | 间隔秒数{默认5s}                     | 画面更新频率                 |
|          | d    | 间隔秒数                             | 画面更新频率                 |
| 头部显示 | l    |                                      | 切换显示平均负载和启动时间   |
|          | t    |                                      | 切换显示进程和CPU状态信息    |
|          | m    |                                      | 切换显示内存信息             |
|          | c    |                                      | 切换显示命令名称和完整命令行 |
| 进程列表 | N    |                                      | 排序，进程PID大小            |
|          | P    |                                      | 排序，CPU占用率大小          |
|          | M    |                                      | 排序，内存占用率大小         |
|          | T    |                                      | 排序，时间/累计时间          |
|          | n    |                                      | 显示，设定显示数量           |
| 帮助     | h    |                                      | 显示帮助信息                 |
| 进程     | K    | PID，signal{15普通终止,9强制结束}    | 杀死进程                     |
|          | r    | 优先级数{默认10，数字越小优先级越高} | 设置优先级                   |
|          | S    |                                      | 切换至累加模式               |

## Top总览

第一行：系统运行时间和平均负载

- 当前时间
- 系统已运行的时间
- 当前登录用户的数量
- 相应最近5、10和15分钟内的平均负载。

第二行：任务或者进程的总结。

第三行：cpu状态

- us, user： 运行(未调整优先级的) 用户进程的CPU时间
- sy，system: 运行内核进程的CPU时间
- ni，niced：运行已调整优先级的用户进程的CPU时间
- wa，IO wait: 用于等待IO完成的CPU时间
- hi：处理硬件中断的CPU时间
- si: 处理软件中断的CPU时间
- st：这个虚拟机被hypervisor偷去的CPU时间（译注：如果当前处于一个hypervisor下的vm，实际上hypervisor也是要消耗一部分CPU处理时间的）。

第四行：内存使用

第四行是物理内存使用，第五行是虚拟内存使用(交换空间)。

物理内存显示如下:全部可用内存、已使用内存、空闲内存、缓冲内存。相似地：交换部分显示的是：全部、已使用、空闲和缓冲交换空间。

第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量。纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心。

对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。

## 进程列表

### 普通显示

PID：进程ID，进程的唯一标识符

USER：进程所有者的实际用户名。

PR：进程的调度优先级。这个字段的一些值是'rt'。这意味这这些进程运行在实时态。

NI：进程的nice值（优先级）。越小的值意味着越高的优先级。负值表示高优先级，正值表示低优先级

VIRT：进程使用的虚拟内存。进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES

RES：驻留内存大小。驻留内存是任务使用的非交换物理内存大小。进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA

SHR：SHR是进程使用的共享内存。共享内存大小，单位kb

S：这个是进程的状态。它有以下不同的值:

- D - 不可中断的睡眠态。
- R – 运行态
- S – 睡眠态
- T – 被跟踪或已停止
- Z – 僵尸态

%CPU：自从上一次更新时到现在任务所使用的CPU时间百分比。

%MEM：进程使用的可用物理内存百分比。

TIME+：任务启动后到现在所使用的全部CPU时间，精确到百分之一秒。

COMMAND：运行进程所使用的命令。进程名称（命令名/命令行）

### 参数解释

a PID 进程id
b PPID 父进程id
c RUSER Real user name
d UID 进程所有者的用户id
e USER 进程所有者的用户名
f GROUP 进程所有者的组名
g TTY 启动进程的终端名。不是从终端启动的进程则显示为 ?
h PR 优先级
i NI nice值。负值表示高优先级，正值表示低优先级
j P 最后使用的CPU，仅在多CPU环境下有意义
k %CPU 上次更新到现在的CPU时间占用百分比
l TIME 进程使用的CPU时间总计，单位秒
m TIME+ 进程使用的CPU时间总计，单位1/100秒
n %MEM 进程使用的物理内存百分比
o VIRT 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES
p SWAP 进程使用的虚拟内存中，被换出的大小，单位kb。
q RES 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA
r CODE 可执行代码占用的物理内存大小，单位kb
s DATA 可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb
t SHR 共享内存大小，单位kb
u nFLT 页面错误次数
v nDRT 最后一次写入到现在，被修改过的页面数。
w S 进程状态。（D=不可中断的睡眠状态，R=运行，S=睡眠，T=跟踪/停止，Z=僵尸进程）
x COMMAND 命令名/命令行
y WCHAN 若该进程在睡眠，则显示睡眠中的系统函数名
z Flags 任务标志，参考 sched.h

### 调整方式

- 通过 f 键可以选择显示的内容。按 f 键之后会显示列的列表，按 a-z 即可显示或隐藏对应的列，最后按回车键确定。
- 按 o 键可以改变列的显示顺序。按小写的 a-z 可以将相应的列向右移动，而大写的 A-Z 可以将相应的列向左移动。最后按回车键确定。
- 按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序。而大写的 R 键可以将当前的排序倒转。

## 标亮和查找

1. b-打开关闭标亮效果
2. y-打开关闭运行态进程标亮效果
3. x-打开关闭排序列标亮效果
4. shift + < | shift + > - 调整标亮的排序列
5. f - 编排视图字段，通过上下操作选择显示或关闭的行列，d修改其显示状态

> 参考博客：[top](https://www.cnblogs.com/zhoug2020/p/6336453.html)