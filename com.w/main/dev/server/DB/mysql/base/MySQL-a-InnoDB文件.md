# 文件

> - 参数文件
> - 日志文件
> - socket文件
> - pid文件
> - MySQL表结构文件
> - 存储引擎文件

## 参数文件

静态&动态变量

## 日志文件

1. 错误日志（error log)

2. 二进制日志（binlog）

    对数据库执行更改的所有操作

    作用：恢复，复制和审计

3. 慢查询日志（slow query log）

    long_query_time = 10(default，单位：s)

    运行时间[>long_query_time]会被记录下

4. 查询日志（log）

    主机名.log

## Socket文件

UNIX系统下使用本地连接可以使用套接字文件

## pid文件

主要提供给系统使用

## 表结构定义文件

跨存储引擎*.frm文件

## 存储引擎文件

### InnoDB存储引擎文件

#### 表空间文件

存储依照表空间存储，默认文件ibdata1(10M)

#### 重做日志文件

每个InnoDB存储引擎至少一个重做日志组，组成ib_logfile0 + ib_logfile1，两个文件循环写入

# 表

## 索引组织表

创建索引，信息来源（1.主键，2.Unieuq not null非空唯一主键，3.自动创建6字节大小指针）

## 逻辑存储结构

构成row--->page--->extent（区)--->段 + 其他段--->表空间

### 表空间

包含所有数据，由多个段构成

### 段

分类有数据段，索引段，回滚段等

### 区

每个区1M，由连续的页构成，为保证连续性，一次会申请4~5个区，默认情况下页大小为16kb(64个连续的页)

InnoDB 1.0.x引入压缩页，1.2.x新增innodb_page_size

每个段开始使用32个连续的页存放数据，使用完后是64个连续的页的申请

### 页

### 行

## 行记录格式

### Redundant

兼容以前版本

格式：变长字段列表（逆序存放）| 记录头信息 | 列数据（多项）

char类型NULL值占用空间

### Compact

5.1开始

格式：变长字段列表（逆序存放） | NULL标志位 | 记录头信息 | 列数据（多项）

**隐藏列**：事务ID列（6字节），回滚指针列（7字节）

若没有定义主键还会有rowid列（6字节）

对于变长字段未使用空间使用0x2c填充

NULL值不占用空间

### 行溢出数据

以BLOB为例，数据页保留部分数据（前768字节），大量数据存储在BLOB页中

### Compressed&Dynamic

旧文件格式：Antelope：Compact， Redundant

新文件格式：Barracuda：Compressed，Dynamic

新的文件格式中BLOB中的数据采用**完全**行溢出，数据页只存储20字节指针，实际数据都在Off Page中

### Char行存储结构

4.1开始，char(N)中N表示为字符长度，而不是字节长度

对于多字节字符编码的Char数据类型存储，InnoDB内部将其视为边长字符类型

## 数据页结构

- File Header(38Byte)
- Page Header(56Byte)
- Infimun&Supremum Records
- Users Records
- Page Directory
- File Trailer(8byte)

Infimun&Supremum Records用于限定记录的边界Infimun比页中所有可能值都小，Super同理

Page Directory存放记录的页的相对位置

## 约束

### 数据完整性

- 主机
- 外键
- 唯一
- 非空
- 默认

### 错误数据约束

某些情况下支持错误数据的写入操作，例如：非空限制列，写入NULL字段

实际操作时会在内部进行转换，再写入

若要严格控制可以设置其检查级别

### ENUM&SET

可以限制数据内容

### 触发器

可以设置一些操作的处理，例如：异常操作写入日志等

### 外键约束

父子表之间的操作，依据不同情况，对父子表数据进行更新以及更新的检查

### 视图

### 物化视图

## 分区表

> 不是在存储引擎层完成，但不是所有存储引擎都支持

分区，将一个表或索引分解为更小更加利于管理

### 类别

- RANGE分区
- LIST分区
- HASH分区
- KEY分区
- COLUMNS分区
- 子分区

NULL值

视NULL小于任何一个非NULL

### 性能

访问模式需要研究，否则可能对性能产生反效果

### 表和分区数据交换
