# RPC

## 为什么要有

更多的是在

## 1.对比同类型技术

Google GRPC

Tencent TARS

Aali Dubbo

Thrift

### 1.1 优缺对比

RESTFUL 风格

- 优点

无状态：HTTP

语义化：GET，POST等，强调以资源为中心

- 缺点

对复杂逻辑，其语义化并不能十分明确，反倒会增加设计难度

RPC

- 优点：

生态：生态完备

功能：除服务调用外对监控，管理等都有比较好的适配

性能：protobuf压缩率高，配合数据结构自定义的流式传输

检查：强类型，编译时校验严格

适配：自动生成SDK

- 缺点：

性能需要：对于多数的系统而言，性能这方面的要求并不会特别高，引入RPC并非是必要的事情

第三方支持：调试的辅助工具等，都不如RESTFUL长久发展来的储备充足，01编码的数据，理解困难，JSON则稍好点

WEB端支持：目前对WEB端的支持还有待发展

### 1.2目前的市场

相对于RESTFUL风格的API编写，RPC确有许多性能、监控上的优势

但存量和市场而言，还是长久发展的RESTFUL占比更大

## 2.应用

RESTFUL 针对请求调用，依赖URL，无需其他信息

GRPC 针对服务发起调用，需要维护调用列表，也就是需要有注册中心的功能

另外对于集群情况，RESTFUL可以基于NGINX完成负载均衡的效果，而RPC目前是基于Client完成的负载（局部的负载均衡构造出全局的负载均衡，故在大流量情况下负载均衡还是很均匀的，少流量情况下可能集中打到部分机器）

## 3.业界工具

### 3.1落地实现

GRPC，Dubbo

### 3.2监控

阿里鹰眼，点评Cat，Google dapper

- 共性

1. 调用链追踪
2. 存在一定的延迟
3. 不占用 `应用` 的资源
4. 需耗费大量的机器做运算， 存储

- 隐患

APP规模变大采用采样的方式获取监控信息，占用应用资源

计算资源不足会导致，整体计算延迟

- 集群模式因对策略

信息汇报采用本地计算的方式，汇总一段时间，例如：1分钟，避免长时间保留无用链接

## 4.基本过程

### 4.1调用过程

- 本地过程调用 

参数压栈

返回地址压栈

call Method

返回值出栈

继续用户程序

- 远程过程调用基本一样

参数序列化

记录返回地址

call Method

结果反序列化

继续用户程序

### 4.2个人理解

当前的多数任务均以线程的方式执行，故以下基于一次R

### 4.2实现

- 客户端

序列化request

网络发送

网络接收

反序列化response

- 服务端

接收数据

反序列化

序列化

发送
