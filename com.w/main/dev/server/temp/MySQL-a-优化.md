# MySQL 优化

## 1.优化方式

Explain 分析SQL语句

慢查询日志

## 2.优化策略

### 2.1设计

特性：

谨慎使用分区

字段：

尽量避免预留字段，未指定类型的情况下修改该字段会对表进行锁定

选择符合要求的最小字段

数据内容：

冷热数据分离，减小宽度

避免存储内容过大

避免为NULL，索引 NULL 列需要额外的空间来保存，比较和计算时要对 NULL 值做特别的处理

注：MySQL 字段长度有限制，TEXT 或 BLOB 类型只能使用前缀索引

索引：

数量限制在5个

基于区分度与左前匹配原则摆放索引字段位置

避免建立冗余索引和重复索引

### 2.2单语句

单语句优化策略

1.参数

尽可能检索需要字段，避免获取不必要的字段

2.条件

尽可能触发索引

子查询，使用Join替换，子查询的结果集无法使用索引

in 的值不要超过 500 个，in 操作可以更有效的利用索引

避免使用转换函数，因为会导致索引失效

不会重复，使用UNION ALL，避免UNION使用临时表做不必要的去重处理

3.索引

除建立聚簇索引外也可建立非聚簇索引

频繁查询优先考虑覆盖索引

### 2.3批量

100 万行以上批量写，批量写会导致主从延迟

pt-online-schema-change 修改大表结构，避免主从延迟和锁表