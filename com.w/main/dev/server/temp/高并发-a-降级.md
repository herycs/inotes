# 降级

## 降级策略

熔断降级，开关降级和限流降级

### 一些实现

延迟请求，不重要请求待服务平缓后执行

页面请求降级，异步请求降级&跳转降级

粒度关闭

读写降级

## 限流降级

### 实现地方

服务消费端，服务提供端

### 常用限流算法

- 计数器

最简单的实现方式 ，维护一个计数器，来一个请求计数加一，达到阈值时，直接拒绝请求。

一般实践中用 ngnix + lua + redis 这种方式

- 令牌桶

以一定频率向令牌桶中增加令牌

请求：取到令牌的则可以进行通信，否则拒绝

优点：速率可调控，可以针对请求情况进行动态的变化

实现：

RateLimiter

- 漏桶算法

以一定的速率处理请求，当请求频率高于当前限制，则拒绝后续请求

缺点：对突发性流量不具备动态处理能力

## 开关降级

当压力较大，关闭一些不重要服务，保证当前关键服务链路的安全

例如：当C作为服务被A->B，E->D调用，ED是不重要服务的话，为保障ABC链路的安全性，关闭ED服务已降低C的压力

## 熔断降级

### 实现地方

服务消费端

策略：统计一个时间窗口的情况作为判断依据

下游服务调用出现问题，则直接拒绝后续请求，在一定时延后放一部分请求到后端，检测返回状态决定是继续限流还是继续熔断

