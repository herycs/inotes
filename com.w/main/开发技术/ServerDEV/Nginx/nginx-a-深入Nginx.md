# 深入

# 基础架构

## 架构设计

### 模块化

- 高度抽象模块化
- 模块接口简单，提供高灵活性
- 配置模块的设计
- 核心模块接口简单化
- 多层次、多类别模块设计

### 事件驱动

### 多阶段异步处理

- 请求分阶段异步处理

阶段划分，阻塞方法：

- 触发事件
- 时间分解
- 定时器处理空转
- 无法划分，使用独立进程处理

### 管理进程、多工作进程

1. 利用多核
2. 负载均衡
3. 负责监控工作进程状态并负责管理其行为

### 平台无关代码设计

### 内存池设计

### 管道过滤

### 其他用户模块

## 核心结构体

ngx_listening_t

ngx_cycle_t

ngx_cycle_t

## nginx启动时框架的处理流程

### worker进程工作流程

### master进程工作过程

# 事件模块

## 定义

## 连接

主动

被动

连接池

## ngx_events_moudle核心

## ngx_event_core_moudle

## epoll

## 定时器

## 处理流程

## 文件异步IO

# 框架初始化

### 管理Http模块的配置项

### 监听端口管理

### server的快速检索

### location的快速检索

### Http请求的11个处理阶段

# Http框架执行流程

### 新建连接

### 第一次可读事件

### 接受Http请求行

### 接受Http请求头

### 处理Http请求

### subequest与post请求

### 处理Http包体

### 发送Http响应

### 结束Http请求 

# upstream机制的设计和实现

### 概述

### 启动

### 与上游建立连接

### 向上游发送请求

### 接收上游响应头部

### 不转发响应

### 转发响应（以下游网速优先转发响应）

# 邮件代理模块

### 模块框架

### 初始化请求

### 接收并解析客户端请求

### 邮件认证

### 与上游服务器间认证交互

# 进程间的通信机制

### 共享内存

### 原子操作

### Nginx频道

### 信号

### 信号量

### 文件锁

### 互斥锁