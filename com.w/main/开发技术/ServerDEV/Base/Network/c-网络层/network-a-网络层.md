# network-网络互连

> ### 引入互连
>
> 网桥或交换机只能分隔冲突域，但不能分隔广播域
>
> 解决网络风暴的策略
>
> > 将广播限定在一定范围
>
> - VLAN：缺点是增加软硬件开销，vlan间通信问题
> - LAN在网络层的互连：路由器，L3交换机

# 网络层概述

## 功能

- **寻址**: 全网的数据交换需要全局统一编制，并且方便查找
- **转发**: 依据表的路由器内部数据交换。(forwarding)就是路由器根据转发表将用户的 IP 数据报从合适的端口转发出去。
- **路由**：分组从源到目的地所经过的端到端路径，路由选择的结果。
- **路由协议**：(routing)则是按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由。

## 实现

### 寻址

分组传递需要解决的问题

- 寻址策略
- 选路方法

### **要求**

- 不可使用MAC地址？

    为了便于全世界的网络互连，MAC地址是写死的，且是在一定范围内流转的，使用划分识别网络会使用非常复杂的硬件地址转换等，而使用IP，借由ARP协议实现 ip - MAC地址的映射是不错的选择

- 重新设计网络层地址：IP  address

> IP地址 ::= { <网络号>, <主机号>}
> 定长、可配置

### 分组转发

基于查表，采用存储转发的方法对分组进行转发：接收并缓存数据分组，提取分组中的目的地址，然后查表决定转发路径。如果没有查到，则丢弃该分组。（隔离广播）

- 转发：就是在收到分组时，根据其目的地址去查找转发表，找出该从哪一个接口将该分组发送出去；
- 转发表(forwarding table)：根据路由表构造；
- 路由表(routing table)：用路由选择算法构造，构造的过程由路由选择协议实现。

**转发表结构**：**目的网络，端口号**

> 将路由表中的下一跳映射到具体的输出端口上

**路由表结构**：**目的地，下一跳**

- 源无关：转发工作与分组的来源无关，因此转发表中不需要源站地址；
- 下一跳：网络的拓扑随时改变，任何路由器在某一时刻只能确定其直接相连的主机状态；（仅与目的网络相关）
- 目的地：站地址？网络地址？（因此IP地址是层次地址。反映网络信息）

### 路由

**直接交付**：在一个直接连接的网络上时，分组从一台主机上直接传送到另一台主机的过程
**间接交付**：不在一个直接连接的网络上时，源主机必须先把分组发给一个路由器

## 网络层设备

### 路由器

主要路由选择+分组转发

### 与交换机比较

- 交换机查转发表的方法决定转发路径，表中存放的是端口与目的MAC地址之间的关系，要用帧中的MAC地址查表；
- 路由器中的路由表存放的是端口与目的网络地址之间的关系，需要从分组中提取目的网络地址来查表。
