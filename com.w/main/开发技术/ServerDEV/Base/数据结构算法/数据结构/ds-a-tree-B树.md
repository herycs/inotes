# BTree

## B树

### 基础

> 英文中的B-Tree，一个 m 阶的B树满足以下条件：

1. 每个结点至多拥有m棵子树；
2. 根结点至少拥有两颗子树（存在子树的情况下），根结点至少有一个关键字；
3. 除了根结点以外，其余每个分支结点至少拥有 m/2 棵子树；
4. 所有的叶结点都在同一层上，B树的叶子结点可以看成是一种外部结点，不包含任何信息；
5. 有 k 棵子树的分支结点则存在 k-1 个关键码，关键码按照递增次序进行排列；
6. 关键字数量需要满足ceil(m/2)-1 <= n <= m-1；

## B树高度

一棵含有N个总关键字数的m阶的B树的最大高度：
$$
\log_(m/2) \frac{N+1}{2} +1
$$

### 为什么要有B树

**原因**：磁盘中有两个机械运动的部分，分别是盘片旋转和磁臂移动。而文件读取需要先定位到磁盘中的块（这个定位过程耗时是比较大的），而后继续数据读取。若数据量很大，那么数据的读取的耗时是比较大的。

**优化**：B树可以在多结点上存储相关信息，而树的层数也可尽量少，在树种查找结点减少结点的访问次数就减少了磁盘的访问，因而性能得到了提高。

查询稳定，查找时间复杂度是O(log2N)。

### 操作

**插入**

结点关键字没达到m-1，直接插入

结点关键字达到m-1

- 结点需要进行分裂，中间关键字提升到父结点，两边关键字分裂为子结点（若是父结点也达到了m-1则需要载此进行分裂）

**删除**

> 查找值，有则删除

删除后，结点关键字满足B树要求

删除后，结点关键字不满足B树要求，向兄弟结点借关键字

- 兄弟结点关键字足够
    - 借关键字给该结点，父结点下移，兄弟结点上移

### 查找

策略：范围查找采用中序遍历

# B*树

## 概念

- B树是B+树的变体，在B+树的**非根**和**非叶子结点**再增加指向**兄弟**的**指针**
- B树定义了非叶子结点关键字个数至少为**(2/3)**M，即块的最低使用率为2/3（代替B+树的1/2）

## 变化

### 分裂

当一个结点满时

1. 如果它的下一个兄弟结点未满，
    1. 那么将一部分数据移到兄弟结点中
    2. 在原结点插入关键字
    3. 修改父结点中兄弟结点的关键字（因为兄弟结点的关键字范围改变了）；
2. 如果兄弟也满了
    1. 在原结点与兄弟结点之间增加新结点，并各复制1/3的数据到新结点
    2. 在父结点增加新结点的指针。

> [参考资料](https://zhuanlan.zhihu.com/p/52028653)