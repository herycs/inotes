# BTree

## B树

### 基础

> 英文中的B-Tree，一个 m阶B树需要满足以下条件（摘自：[百度百科-B树]([https://baike.baidu.com/item/B%E6%A0%91](https://baike.baidu.com/item/B树))）：

1. 根结点至少有两个子女；

2. 每个非根节点所包含的关键字个数 j 满足：┌m/2┐ - 1 <= j <= m - 1；

3. 除根结点以外的所有结点（不包括叶子结点）的度数正好是关键字总数加1，故**内部子树**个数 k 满足：m/2 <= k <= m

4. 所有的叶子结点都位于同一层。

    - 在B-树中，每个结点中关键字从小到大排列，并且当该结点的孩子是非叶子结点时，该k-1个关键字正好是k个孩子包含的关键字的值域的分划。

    - 因为叶子结点不包含关键字，所以可以把叶子结点看成在树里实际上并不存在外部结点，指向这些外部结点的指针为空，叶子结点的数目正好等于树中所包含的关键字总个数加1。

    - B-树中的一个包含n个关键字，n+1个指针的结点的一般形式为： （n,P0,K1,P1,K2,P2,…,Kn,Pn）

    - 其中，Ki为关键字，K1<K2<…<Kn, Pi 是指向包括Ki到Ki+1之间的关键字的子树的指针。

## B树高度

一棵含有N个总关键字数的m阶的B树的最大高度：
$$
\log_(m/2) \frac{N+1}{2} +1
$$

### 为什么要有B树

**原因**：磁盘中有两个机械运动的部分，分别是盘片旋转和磁臂移动。而文件读取需要先定位到磁盘中的块（这个定位过程耗时是比较大的），而后继续数据读取。若数据量很大，那么数据的读取的耗时是比较大的。

**优化**：B树可以在多结点上存储相关信息，而树的层数也可尽量少，在树种查找结点减少结点的访问次数就减少了磁盘的访问，因而性能得到了提高。

查询稳定，查找时间复杂度是O(log2N)。

### 操作

**插入**

- 结点关键字没达到m-1，直接插入
- 结点关键字达到m-1
    - 结点需要进行分裂，中间关键字提升到父结点，两边关键字分裂为子结点（若是父结点也达到了m-1则需要载此进行分裂）

**删除**

> 查找值，有则删除

- 删除后，结点关键字满足B树要求
- 删除后，结点关键字不满足B树要求，向兄弟结点借关键字
    - 兄弟结点关键字足够
        - 借关键字给该结点，父结点下移，兄弟结点上移

### 查找

策略：范围查找采用中序遍历