# 架构

## 垂直架构

复杂应用维护成本变高，部署效率逐渐降低

团队协作效率差，公有模块重复开发

系统可靠性变差，大流量，高并发导致容易雪崩

维护和定值困难，业务代码膨胀

新功能上线周期变长

## RPC

简单：语义明确简单，更加易于建立分布式计算

高效：过程调用看起来十分简单而且高效

通用：单机计算过程往往是不同算法和API，通用的通信机制

核心技术点：

- 远程服务提供者需要以某种形式提供服务调用相关信息
- 远程代理对象：服务调用者调用的服务实质上是远程服务的本地代理
- 通信：RPC框架与具体协议无关
- 序列化：对象的传输

## SOA

粗粒度、松耦合

特点：

- 服务可重用
- 服务共享标准契约
- 服务松耦合
- 服务是底层逻辑的抽象
- 服务是可组合的、可编排的
- 服务是自治的
- 服务是无状态的
- 服务是可被自动发现的

## 微服务

SOA解决了应用服务化，业务深入后，服务规模越来越大，治理困难越来越大

微服务特征：

- 原子服务，专注于一件事，“单一职责原则”
- 高密度部署：重要服务可独立进程部署
- 敏捷交付：小团队开发维护，真正的DevOps
- 微自治：服务足够小，功能单一，可独立打包，部署，升级，回滚和弹性伸缩，不依赖其他服务，实现局部自治

## SOA&微服务

| 项目         | SOA                            | 微服务                                                       |
| ------------ | ------------------------------ | ------------------------------------------------------------ |
| 服务拆分粒度 | 异构应用服务化                 | 服务拆分尽可能小                                             |
| 服务依赖     | 需要重用已有资产，存在大量依赖 | 服务自治，功能单一独立                                       |
| 服务规模     | 粒度大，多个服务一个war包      | 粒度小，尽可能独立部署                                       |
| 架构差异     |                                | 模块增加，通信保障力度需要提高                               |
| 服务治理     | 静态治理                       | 动态治理                                                     |
| 敏捷交付     |                                | 小团队负责，设计、开发、测试、部署、线上治理，灰度发布和下线 |

## 各种架构

MVC：应用小

RPC：垂直应用增多

SOA：业务增加，服务数量增多，服务生命周期管理，动态运行治理成为瓶颈

微服务：敏捷开发、持续交付，DevOps

## 分布式服务框架

### 诞生背景

集中走向分布式

- 应用规模变大
- 代码复用难度提高，公共模块是进程内部的本地API调用，开发通常可能需要编写重复的模块，且公共模块需要调整所有的模块都需要重新修订
- 敏捷交付难度增大，业务间的循环依赖

大规模应用的拆分：

- 纵向拆分：梳理业务，依据业务特性进行拆分，不同业务独立部署，例如：CRM系统-》客户域，产品域，资源域，营销管理等
- 横向拆分：核心、公共业务拆分，使用分布式框架部署，将业务服务化

### 服务治理

- 生命周期管理
- 服务容量治理
- 运行期治理
- 服务安全

### SOA过程

- 计划：确定服务治理重点
- 定义：定义治理模型
- 启用：实现并实施治理
- 度量：依据实际效果，改进服务治理模型

### 分布式框架

#### Dubbo

- 轻量级Java容器，通过Main函数初始化Spring上下文，依据XML文件设定，将服务以指定协议发布
- 连接注册中心，发布信息到注册中心
- 消费者依据XML连接注册中心，获取指定服务信息
- 注册中心基于订阅关系，定向推送服务地址信息
- 消费者调动服务时依据本地缓冲服务提供者地址列表中选取一个提供者，进行处理

质量

- 连通性：服务中心
- 健壮性：监控中心
- 伸缩性：
- 扩展性：微内核+插件 | 管道式设计 | 原子化扩展点

淘宝HFS

亚马逊 Coral Service

特点：

- 多协议
- 轻量级架构
- 配置化开发
- 与亚马逊其他基础设施集成，实现DevOps