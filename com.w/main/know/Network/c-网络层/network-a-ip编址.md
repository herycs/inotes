# IPv4编址

## 接口

- P地址: 对主机、路由器接口的32-bit 标识符 
- 接口: 在主机/路由器和物理链路之间的连接
    - 路由器通常具有多个接口
    - 主机可能具有多个接口
    - IP编址与每个接口相联系

## 点分十进制记法

IP编址(IP addressing)：IP地址 ::= { <网络号>, <主机号>}

> IP地址长32 bit长，共能容纳232(约40亿)个IP地址
>
> 机器中存放的 IP 地址是 32 bit 二进制代码

处理32进制

1. 每隔 8 bit 插入一个空格以提高可读性(1........)
2. 将每 8 bit 的二进制数转换为十进制数(192 168 1 1)
3. 采用点分十进制记法则进一步提高可读性（处理到此处的IP，eg: 192.168.1.1）

## 地址演化

分类的IP地址：这是最基本的编址方法，在 1981 年就通过了相应的标准协议。

子网划分方案：这是对最基本的编址方法的改进，其标准[RFC 950]在 1985 年通过。

CIDR方案（现行）：这是比较新的无分类编址方法。1993 年提出后很快就得到推广应用。

IPv6地址（现行）：目前可以申请到的

## 地址分类

- a类地址 2^7-1 = 127- 1 = 126个，减一的原因是当后续为0 时就会和全0冲突
- b 2^15 个,c 2^23 地址个数不需要减一

![image-20200510195708862](C:\Users\ANGLE0\AppData\Roaming\Typora\typora-user-images\image-20200510195708862.png)

分类中可用的IP地址范围：

| 地址类别 | 网络号可用范围      | 主机号可用范围    |
| -------- | ------------------- | ----------------- |
| A        | 1-126               | 0.0.1-255.255.254 |
| B        | 128.0-191.255       | 0.1-255.254       |
| C        | 192.0.0-223.255.255 | 1-254             |

D：不是节点地址，不可用于主机

**特殊IP地址**

- 全0表示this；
- 全1表示广播；
- 127开头的A类地址用于“环回测试”。

| 网络号 | 主机号 | 源地址 | 目的地址 | 含义                       |
| ------ | ------ | ------ | -------- | -------------------------- |
| 0      | 0      | 可用   | 不可用   | 本网络，本主机，this       |
| 0      | 合法ID | 可用   | 不可用   | 本网络，某一个主机         |
| 合法ID | 0      | 可用   | 可用     | 某个网络                   |
| 1      | 1      | 不可用 | 可用     | 本网络内广播，路由器不转发 |
| 合法ID | 1      | 不可用 | 可用     | ID指定网络内广播           |
| 127    | 合法ID | 可用   | 可用     | 本地环回测试               |

## 划分子网

分类IP存在的问题

1. IP地址空间的利用率有时很低。
2. 给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。
3. 两级的IP地址在扩展网络时不够灵活。

解决方法：划分子网

> 将物理网络进一步划分为若干独立的组成部分，每个部分称为这一网络（或更高一级子网）的子网。
>
> 对外仍表现为一个没有划分子网的网络。

什么是子网 ?subnet

- IP地址子网相同部分的设备接口
- 能够物理上互相到达而没有中间路由器

### 结果

- 划分子网不但没有解决问题,反而加剧
- 因特网主干路由表项目遽增
- IP地址耗尽或是路由表会崩溃

### 解决方法

- 长远：IPV6 128bit
- 近期：采用无分类域间路由CIDR（classless Inter -Domain Routing）缓解
    RFC 1517-1520

## 无类别域间路由选择

> (Classless InterDomain Routing, CIDR)

把一块相邻接的IP地址压缩成一个表项

**结构**： IP地址 ::= { <网络地址>/<前缀>}

- 以a.b.c.d开始且前缀为x的所有IP地址均从对应的接口转发
- 连续IP地址，路由器转发表上仅对应为一个表项
- CIDR技术对于解决因特网路由器转发表空间急剧膨胀的问题至关重要

**子网掩码**

每个子网定义一个32位二进制数

![image-20200510201628062](C:\Users\ANGLE0\AppData\Roaming\Typora\typora-user-images\image-20200510201628062.png)

**作用**

获得主机子网地址
      IP地址 & 子网掩码 = 含子网号的网络地址
		 &：按位“与”运算
判断目标地址

- 设本地主机所在子网地址为Nx，子网掩码为Mx，远程主机的IP地址为IP y，再设Ny= IP y & Mx 
        若Nx==Ny，则认定远程主机与本地主机在同一子网上
        若Nx<>Ny，则认定远程主机与本地主机不在同一子网上

### 地址聚合，路由汇聚

> 前缀越短，包含地址数越多

1. CIDR将网络前缀都相同的连续的地址聚合成“CIDR地址块”

    ```sql
    例如，128.14.32.0/20表示的地址块有212个地址：
    128.14.32.0         10000000 00001110 00100000 00000000
    128.14.47.255       10000000 00001110 00101111 11111111 
    ```

2. 在路由表中利用CIDR地址块来表示目的网络，使得路由表中的一个项目可以表示很多个原来传统分类地址的路由，这称为路由聚合。

> 好处：大大压缩路由表项目数
> 注意：CIDR地址块中地址数必为2的整数幂

二叉线索路由表及最长前缀匹配

最长前缀匹配规则：前15bit和路由表第一项匹配，前17项与第二项匹配，则选择第二项

IPv4地址采用32bit，IPv6地址采用128bit，由网络号和主机号两部分组成。其中，网络号和主机号不允许为全0和全1。